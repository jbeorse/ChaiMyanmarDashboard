<!DOCTYPE html>
<html>
<head>
    <title>Simple Stack</title>
    <script src="http://d3js.org/d3.v2.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="{{url_for('static', filename='jquery.js') }}">\x3C/script>')</script>
    <style>
        svg {
            border: solid 1px #ccc;
            font: 10px sans-serif;
            shape-rendering: crispEdges;
        }
    </style>
</head>
<body>

    <div id="viz"></div>

    <!--
    <p>
        Cached Result name: <input type=text size=50 name=cache_name><br />
        <span id=result>?</span>
    <p>
        <a href=# id=get_result>Get cached result</a>
        -->
    avgAgePerState:<br /> <span id=avgAgePerState>?</span><br /><br />
    avgAgePerTown:<br /> <span id=avgAgePerTown>?</span><br /><br />
    avgAgePerProvince:<br /> <span id=avgAgePerProvince>?</span><br /><br />
    avgAgePerFacilityName:<br /> <span id=avgAgePerFacilityName>?</span><br /><br />
    avgAgePerFacilityType:<br /> <span id=avgAgePerFacilityType>?</span><br /><br />

    eidTestResultTotal:<br /> <span id=eidTestResultTotal>?</span><br /><br />
    eidTestResultAIDSTFacilityType:<br /> <span id=eidTestResultAIDSTFacilityType>?</span><br /><br />
    eidTestResultAMIFacilityType:<br /> <span id=eidTestResultAMIFacilityType>?</span><br /><br />
    eidTestResultDisHFacilityType:<br /> <span id=eidTestResultDisHFacilityType>?</span><br /><br />
    eidTestResultGenHFacilityType:<br /> <span id=eidTestResultGenHFacilityType>?</span><br /><br />
    eidTestResultMSFHFacilityType:<br /> <span id=eidTestResultMSFHFacilityType>?</span><br /><br />
    eidTestResultNHLFacilityType:<br /> <span id=eidTestResultNHLFacilityType>?</span><br /><br />
    eidTestResultSpHFacilityType:<br /> <span id=eidTestResultSpHFacilityType>?</span><br /><br />
    eidTestResultSRHFacilityType:<br /> <span id=eidTestResultSRHFacilityType>?</span><br /><br />
    eidTestResultTHFacilityType:<br /> <span id=eidTestResultTHFacilityType>?</span><br /><br />

    avgTatTotal:<br /> <span id=avgTatTotal>?</span><br /><br />
    avgTatAIDSTFacilityType:<br /> <span id=avgTatAIDSTFacilityType>?</span><br /><br />
    avgTatAMIFacilityType:<br /> <span id=avgTatAMIFacilityType>?</span><br /><br />
    avgTatDisHFacilityType:<br /> <span id=avgTatDisHFacilityType>?</span><br /><br />
    avgTatGenHFacilityType:<br /> <span id=avgTatGenHFacilityType>?</span><br /><br />
    avgTatMSFHFacilityType:<br /> <span id=avgTatMSFHFacilityType>?</span><br /><br />
    avgTatNHLFacilityType:<br /> <span id=avgTatNHLFacilityType>?</span><br /><br />
    avgTatSpHFacilityType:<br /> <span id=avgTatSpHFacilityType>?</span><br /><br />
    avgTatSRHFacilityType:<br /> <span id=avgTatSRHFacilityType>?</span><br /><br />
    avgTatTHFacilityType:<br /> <span id=avgTatTHFacilityType>?</span><br /><br />

    trackSample:<br /> <span id=trackSample>?</span><br /><br />

    avgAgeNHL:<br /> <span id=avgAgeNHL>?</span><br /><br />
    avgAgePHL:<br /> <span id=avgAgePHL>?</span><br /><br />
    avgAgeUNION:<br /> <span id=avgAgeUNION>?</span><br /><br />

    eidTestResultNHLLab:<br /> <span id=eidTestResultNHLLab>?</span><br /><br />
    eidTestResultPHLLab:<br /> <span id=eidTestResultPHLLab>?</span><br /><br />
    eidTestResultUNIONLab:<br /> <span id=eidTestResultUNIONLab>?</span><br /><br />

    avgTatNHLLab:<br /> <span id=avgTatNHLLab>?</span><br /><br />
    avgTatPHLLab:<br /> <span id=avgTatPHLLab>?</span><br /><br />
    avgTatUNIONLab:<br /> <span id=avgTatUNIONLab>?</span><br /><br />

        <script type="text/javascript">

            $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

            ///////////////////////////////////////////// Query imports /////////////////////////////////////////////////////
 
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgePerState', {}, function(data) {
                $("#avgAgePerState").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgePerTown', {}, function(data) {
                $("#avgAgePerTown").text(data.result);
            }); 
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgePerProvince', {}, function(data) {
                $("#avgAgePerProvince").text(data.result);
            }); 
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgePerFacilityName', {}, function(data) {
                $("#avgAgePerFacilityName").text(data.result);
            }); 
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgePerFacilityType', {}, function(data) {
                $("#avgAgePerFacilityType").text(data.result);
            }); 


            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultTotal', {}, function(data) {
                $("#eidTestResultTotal").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultAIDSTFacilityType', {}, function(data) {
                $("#eidTestResultAIDSTFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultAMIFacilityType', {}, function(data) {
                 $("#eidTestResultAMIFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultDisHFacilityType', {}, function(data) {
                $("#eidTestResultDisHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultGenHFacilityType', {}, function(data) {
                $("#eidTestResultGenHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultMSFHFacilityType', {}, function(data) {
                $("#eidTestResultMSFHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultNHLFacilityType', {}, function(data) {
                $("#eidTestResultNHLFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultSpHFacilityType', {}, function(data) {
                $("#eidTestResultSpHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultSRHFacilityType', {}, function(data) {
                $("#eidTestResultSRHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultTHFacilityType', {}, function(data) {
                $("#eidTestResultTHFacilityType").text(data.result);
            });


            $.getJSON($SCRIPT_ROOT + '/_get_avgTatTotal', {}, function(data) {
                $("#avgTatTotal").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatAIDSTFacilityType', {}, function(data) {
                $("#avgTatAIDSTFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatAMIFacilityType', {}, function(data) {
                $("#avgTatAMIFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatDisHFacilityType', {}, function(data) {
                $("#avgTatDisHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatGenHFacilityType', {}, function(data) {
                $("#avgTatGenHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatMSFHFacilityType', {}, function(data) {
                $("#avgTatMSFHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatNHLFacilityType', {}, function(data) {
                $("#avgTatNHLFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatSpHFacilityType', {}, function(data) {
                $("#avgTatSpHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatSRHFacilityType', {}, function(data) {
                $("#avgTatSRHFacilityType").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatTHFacilityType', {}, function(data) {
                $("#avgTatTHFacilityType").text(data.result);
            });


            $.getJSON($SCRIPT_ROOT + '/_get_trackSample', {}, function(data) {
                $("#trackSample").text(data.result);
            });

            $.getJSON($SCRIPT_ROOT + '/_get_avgAgeNHL', {}, function(data) {
                $("#avgAgeNHL").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgePHL', {}, function(data) {
                $("#avgAgePHL").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgAgeUNION', {}, function(data) {
                $("#avgAgeUNION").text(data.result);
            });

            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultNHLLab', {}, function(data) {
                $("#eidTestResultNHLLab").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultPHLLab', {}, function(data) {
                $("#eidTestResultPHLLab").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_eidTestResultUNIONLab', {}, function(data) {
                $("#eidTestResultUNIONLab").text(data.result);
            });

            $.getJSON($SCRIPT_ROOT + '/_get_avgTatNHLLab', {}, function(data) {
                $("#avgTatNHLLab").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatPHLLab', {}, function(data) {
                $("#avgTatPHLLab").text(data.result);
            });
            $.getJSON($SCRIPT_ROOT + '/_get_avgTatUNIONLab', {}, function(data) {
                $("#avgTatUNIONLab").text(data.result);
            });
            /*
            $(function() {
                $('a#get_result').bind('click', function() {
                    $.getJSON($SCRIPT_ROOT + '/_get_results', {
                        cacheName: $('input[name="cache_name"]').val(),
                    }, function(data) {
                        console.log('Cached RESULTS:     !!!!!!!')
                        console.log(data.result)
                        $("#result").text(data.result);
                    });
                    return false;
                });
            });
            */

            /////////////////////////////////////////// End Query Import ////////////////////////////////////////////////////



            ////////////////////////////////////////  D3 with import example ////////////////////////////////////////////////
            var w = 960,
            h = 500

            // create canvas
            var svg = d3.select("#viz").append("svg:svg")
            .attr("class", "chart")
            .attr("width", w)
            .attr("height", h )
            .append("svg:g")
            .attr("transform", "translate(10,470)");

            x = d3.scale.ordinal().rangeRoundBands([0, w-50])
            y = d3.scale.linear().range([0, h-50])
            z = d3.scale.ordinal().range(["darkblue", "blue", "lightblue"])

            console.log("RAW MATRIX---------------------------");
            // 4 columns: ID,c1,c2,c3
            var matrix = {{ data_arr }}
            console.log(matrix)

            console.log("REMAP---------------------------");
            var remapped =["c1","c2","c3"].map(function(dat,i){
                return matrix.map(function(d,ii){
                    return {x: ii, y: d[i+1] };
                })
            });
            console.log(remapped)

            console.log("LAYOUT---------------------------");
            var stacked = d3.layout.stack()(remapped)
            console.log(stacked)

            x.domain(stacked[0].map(function(d) { return d.x; }));
            y.domain([0, d3.max(stacked[stacked.length - 1], function(d) { return d.y0 + d.y; })]);

            // show the domains of the scales
            console.log("x.domain(): " + x.domain())
            console.log("y.domain(): " + y.domain())
            console.log("------------------------------------------------------------------");

            // Add a group for each column.
            var valgroup = svg.selectAll("g.valgroup")
            .data(stacked)
            .enter().append("svg:g")
            .attr("class", "valgroup")
            .style("fill", function(d, i) { return z(i); })
            .style("stroke", function(d, i) { return d3.rgb(z(i)).darker(); });

            // Add a rect for each date.
            var rect = valgroup.selectAll("rect")
            .data(function(d){return d;})
            .enter().append("svg:rect")
            .attr("x", function(d) { return x(d.x); })
            .attr("y", function(d) { return -y(d.y0) - y(d.y); })
            .attr("height", function(d) { return y(d.y); })
            .attr("width", x.rangeBand());

        </script>
</body>
</html>